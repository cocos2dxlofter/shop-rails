<h1>查看订单</h1>
<% if flash[:notice] || flash[:error]  %>
<div class="alert <%= "alert-success" if flash[:notice] %> <%= "alert-danger" if flash[:error] %>">
  <a class="close" data-dismiss="alert">×</a>
  <%= flash[:notice] %><%= flash[:error] %>
</div>
<% end %>

<p>
  <strong>订单编号:</strong>
  <%= @shop_order.order_no %>
</p>
<p>
  <strong>支付方式:</strong>
  <%= @shop_order.pay_way_name %>
</p>
<p>
  <strong>交易编号:</strong>
  <%= @shop_order.trade_no %>
</p>
<p>
  <strong>订单折扣:</strong>
  <%=  @shop_order.discount %>%
</p>
<p>
  <strong>订单总价:</strong>
  <%= format("%.2f",@shop_order.total_fee / 100.0) %>元
</p>

<p>
  <strong>产品费用:</strong>
  <%= format("%.2f",@shop_order.product_fee / 100.0)  %>元
</p>

<p>
  <strong>订单运费:</strong>
  <%= format("%.2f",@shop_order.transport_fee / 100.0)  %>元
</p>

<p>
  <strong>是否支付:</strong>
  <%= bool_label(@shop_order.is_paid) %>
</p>
<p>
  <strong>支付时间:</strong>
  <%= @shop_order.paid_date.strftime('%Y-%m-%d %H:%M') if @shop_order.paid_date  %>
</p>
<p>
  <strong>是否发货:</strong>
  <%= bool_label(@shop_order.is_delivered) %>
</p>
<p>
  <strong>发货时间:</strong>
  <%= @shop_order.delivery_date.strftime('%Y-%m-%d %H:%M') if @shop_order.delivery_date %>
</p>
<p>
  <strong>收货人姓名:</strong>
  <%= @shop_order.receiver_name %>
</p>
<p>
  <strong>收货人手机:</strong>
  <%= @shop_order.receiver_mobile %>
</p>
<p>
  <strong>收货地址:</strong>
  <%= @shop_order.receiver_address %>
</p>
<p>
  <strong>收货邮编:</strong>
  <%= @shop_order.receiver_zip %>
</p>
<p>
  <strong>备注:</strong>
  <%= @shop_order.remark %>
</p>

<p>
  <strong>Openid:</strong>
  <%= @shop_order.openid %>
</p>
<p>
  <strong>相关客户:</strong>
  <%= link_to @shop_order.customer.name,@shop_order.customer if @shop_order.customer %>
</p>
<!--
<%= link_to ' 修改 ', shop.edit_order_path(@shop_order) ,:class => 'btn btn-primary' unless @shop_order.is_paid%> 
-->
<%= link_to ' 返回 ', shop.orders_path ,:class => 'btn btn-default'%>

<h2>订单条目列表 
  <!--
  <small>
<%= link_to '新增条目', shop.new_order_item_path(:order_id => @shop_order) ,:class => 'btn btn-primary' unless @shop_order.is_paid %>
-->
<small>
</h1>

<table class="table table-striped table-bordered table-condensed">
  <thead>
    <tr>
      <th>产品SKU编码</th>
      <th>产品名称</th> 
      <th>产品数量</th>  
      <th>产品单价</th>     
      <th>产品折扣</th> 
      <th>小计金额</th>  
      <!--
      <th></th>
      <th></th>
    -->
    </tr>
  </thead>

  <tbody>
    <%
       total = 0
       @shop_order.order_items.each do |item| 
       subtotal = item.price * item.quantity * item.discount / 100.0
       total += subtotal
    %>
      <tr>
        <td><%= item.product_sku.code %></td>
        <td><%= item.product_sku.product.name + "(" + item.product_sku.product_sku_property_list +  ")" %></td>
        <td><%= item.quantity %></td>      
        <td><%= format("%.2f",item.price/100.0) %> 元</td>   
        <td><%= item.discount %>%</td>   
        <td><%= format("%.2f",subtotal/100.0) %> 元</td>         
        <!--        
        <td><%= link_to '修改', shop.edit_order_item_path(item) unless @shop_order.is_paid %></td>
        <td><%= link_to '删除', item, method: :delete, data: { confirm: '您确定要删除吗?' } unless @shop_order.is_paid %></td>
      -->
      </tr>
    <% end %>
    <tr>
      <td colspan="5" align="right">合计金额</td>
      <td colspan="3" align="left"><%= format("%.2f",total/100.0) %> 元</td>
    </tr>
  </tbody>
</table>